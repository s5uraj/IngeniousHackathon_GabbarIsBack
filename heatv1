#include <PinChangeInt.h>
#include <eHealth.h>

String readString;

void setup() {
  
  Serial.begin(115200);  
  
   eHealth.initPulsioximeter();
  PCintPort::attachInterrupt(6, readPulsioximeter, RISING);
  
}

void loop() {
  
  while (Serial.available())
  {
    if (Serial.available() >0)
    {
      readString = "";
      char c = Serial.read();  //gets one byte from serial buffer
      readString += c; //makes the string readString
      Serial.flush();     
    } 
   
  }
 if (readString == "1")
 {
      
        get_temp();
 }    
   if(readString == "2")
      {
        get_emg();
      }
if(readString == "3")
{
  
 get_bpm(); 
}

  delay(1000);	
}
//get body temperature average of 10
void get_temp()
{
  Serial.flush();
  float temperature = eHealth.getTemperature();
  Serial.println(temperature);
  Serial.flush();
  
}
void get_emg()
{
  Serial.flush();
  int EMG = eHealth.getEMG();
  Serial.println(EMG);  
  Serial.flush();
}
void get_bpm()
{
  Serial.print(eHealth.getBPM());
  
}

void readPulsioximeter(){  

  cont ++;

  if (cont == 50) { //Get only of one 50 measures to reduce the latency
    eHealth.readPulsioximeter();  
    cont = 0;
  }
}


